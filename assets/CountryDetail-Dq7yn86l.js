import{j as t,a as l}from"./react-BWFZKfll.js";import{a as U}from"./countryService-jQlbHOkd.js";import{a as g,d as y}from"./index-BUhhF4zt.js";import{g as w,r as K,a as W}from"./userCountryService-DQ0B1ZQ_.js";import{q as V,d as q,w as $,e as M,f as _,h as z,T as G,j as D,k as H,u as J}from"./@firebase-T3z05RUZ.js";import{b as Q,L as X}from"./react-router-weGfgXep.js";import"./axios-xsH4HHeE.js";import"./react-dom-B0g7UFVY.js";import"./scheduler-SPyfQU6S.js";import"./firebase-CGqC1wPX.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./cookie--_YQFYBD.js";const p="countryComments",Y=async(e,s)=>{const r=g.currentUser;if(!r)throw new Error("Kirjautuminen vaaditaan");await z(M(y,p),{countryCca3:e,userId:r.uid,userEmail:r.email||"",text:s,createdAt:G.now()})},Z=async e=>{const s=V(M(y,p),$("countryCca3","==",e),q("createdAt","asc"));return(await _(s)).docs.map(o=>({id:o.id,...o.data()}))},tt=async(e,s)=>{if(!g.currentUser)throw new Error("Kirjautuminen vaaditaan");const o=D(y,p,e);await J(o,{text:s})},et=async e=>{if(!g.currentUser)throw new Error("Kirjautuminen vaaditaan");const r=D(y,p,e);await H(r)},st=({comments:e,userId:s,editingId:r,editingText:o,setEditingId:d,setEditingText:c,onEdit:u,onDelete:m})=>t.jsx("ul",{style:{listStyle:"none",padding:0},children:e.map(i=>t.jsxs("li",{style:{marginBottom:16,background:"#f3f7fa",borderRadius:8,padding:12},children:[t.jsx("div",{style:{fontWeight:500,color:"#185a9d",marginBottom:4},children:i.userEmail||"Tuntematon käyttäjä"}),r===i.id?t.jsxs(t.Fragment,{children:[t.jsx("textarea",{value:o,onChange:h=>c(h.target.value),rows:2,style:{width:"100%",maxWidth:400}}),t.jsxs("div",{style:{marginTop:4},children:[t.jsx("button",{onClick:()=>u(i.id),style:{marginRight:8},children:"Tallenna"}),t.jsx("button",{onClick:()=>{d(null),c("")},children:"Peruuta"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginBottom:4},children:i.text}),s===i.userId&&t.jsxs("div",{children:[t.jsx("button",{onClick:()=>{d(i.id),c(i.text)},style:{marginRight:8,background:"#2980ef",color:"white"},children:"Muokkaa"}),t.jsx("button",{onClick:()=>m(i.id),style:{background:"#e74c3c",color:"white"},children:"Poista"})]})]}),t.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:i.createdAt.toDate().toLocaleString("fi-FI")})]},i.id))}),nt=({value:e,onChange:s,onSubmit:r,disabled:o})=>t.jsxs("form",{onSubmit:r,style:{marginBottom:16},children:[t.jsx("textarea",{value:e,onChange:s,rows:2,style:{width:"100%",maxWidth:400},placeholder:"Jätä julkinen kommentti...",disabled:o}),t.jsx("button",{type:"submit",style:{marginTop:8},disabled:o,children:"Lähetä"})]}),yt=()=>{var T,S,A;const{cca3:e}=Q(),[s,r]=l.useState(null),[o,d]=l.useState(!0),[c,u]=l.useState(null),[m,i]=l.useState({visited:[],wishlist:[]}),[h,F]=l.useState([]),[f,C]=l.useState(""),[I,v]=l.useState(null),[k,b]=l.useState(""),n=g.currentUser;l.useEffect(()=>{(async()=>{d(!0),u(null);try{if(e){const x=await U(e);r(x)}}catch{u("Maan tietoja ei voitu hakea.")}finally{d(!1)}})()},[e]),l.useEffect(()=>{n&&e&&w(n).then(i)},[n,e]);const j=async()=>{if(e){const x=[...await Z(e)].sort((B,N)=>B.createdAt.toMillis()-N.createdAt.toMillis());F(x)}};l.useEffect(()=>{j()},[e]);const E=async a=>{n&&e&&(await W(n,a,e),w(n).then(i))},L=async a=>{n&&e&&(await K(n,a,e),w(n).then(i))},O=async a=>{a.preventDefault(),!(!n||!f.trim()||!e)&&(await Y(e,f.trim()),C(""),await j())},R=async a=>{!n||!k.trim()||(await tt(a,k.trim()),v(null),b(""),await j())},P=async a=>{n&&(await et(a),await j())};return o?t.jsx("p",{children:"Ladataan tietoja..."}):c?t.jsx("p",{style:{color:"red"},children:c}):s?t.jsxs("div",{className:"country-detail-layout",children:[t.jsxs("div",{className:"country-detail-main",children:[t.jsx(X,{to:"/countries",children:"← Takaisin listaan"}),t.jsx("h1",{children:s.name.common}),t.jsx("img",{src:s.flags.svg,alt:`Lippu: ${s.name.common}`,style:{maxWidth:200}}),((T=s.coatOfArms)==null?void 0:T.svg)&&t.jsxs("div",{children:[t.jsx("h3",{children:"Vaakuna"}),t.jsx("img",{src:s.coatOfArms.svg,alt:`Vaakuna: ${s.name.common}`,style:{maxWidth:150}})]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Pääkaupunki:"})," ",((S=s.capital)==null?void 0:S.join(", "))||"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Väkiluku:"})," ",s.population.toLocaleString("fi-FI")]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Pinta-ala:"})," ",s.area.toLocaleString("fi-FI")," km²"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Maanosa:"})," ",s.region," (",s.subregion,")"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Valuutat:"})," ",s.currencies?Object.values(s.currencies).map(a=>a.name+(a.symbol?` (${a.symbol})`:"")).join(", "):"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Kielet:"})," ",s.languages?Object.values(s.languages).join(", "):"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Rajanaapurit:"})," ",(A=s.borders)!=null&&A.length?s.borders.join(", "):"Ei"]}),t.jsx("p",{children:t.jsx("a",{href:s.maps.googleMaps,target:"_blank",rel:"noopener noreferrer",children:"Avaa Google Mapsissa"})}),n&&e&&t.jsx("div",{style:{marginTop:32},children:t.jsxs("div",{style:{display:"flex",gap:16},children:[m.visited.includes(e)?t.jsx("button",{onClick:()=>L("visited"),style:{background:"#e74c3c",color:"white"},children:"Poista merkintä käynnistäni"}):t.jsx("button",{onClick:()=>E("visited"),style:{background:"#27ae60",color:"white"},children:"Olen käynyt täällä!"}),m.wishlist.includes(e)?t.jsx("button",{onClick:()=>L("wishlist"),style:{background:"#e74c3c",color:"white"},children:"Poista matka toivelistaltani!"}):t.jsx("button",{onClick:()=>E("wishlist"),style:{background:"#2980ef",color:"white"},children:"Haluan matkustaa tänne!"})]})})]}),t.jsx("div",{className:"country-detail-side",children:t.jsxs("div",{className:"comment-section",style:{marginTop:40},children:[t.jsx("h3",{children:"Kommentit"}),n&&e&&t.jsx(nt,{value:f,onChange:a=>C(a.target.value),onSubmit:O}),h.length===0&&t.jsx("p",{children:"Ei kommentteja vielä."}),t.jsx(st,{comments:h,userId:n==null?void 0:n.uid,editingId:I,editingText:k,setEditingId:v,setEditingText:b,onEdit:R,onDelete:P})]})})]}):t.jsx("p",{children:"Maatietoja ei löytynyt."})};export{yt as default};
