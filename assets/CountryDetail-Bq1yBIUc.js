import{g as h,a as U,r,j as t,L as K}from"./index-CL9d_0sK.js";import{a as W}from"./countryService-BphEq_ek.js";import{g as p,r as V,a as q}from"./userCountryService-DxlmJTsJ.js";import{q as $,o as _,w as z,c as M,g as G,b as H,T as J,d as D,e as m,u as Q,f as X}from"./firebaseConfig-Db1l8lSu.js";const g="countryComments",Y=async(s,n)=>{const i=h().currentUser;if(!i)throw new Error("Kirjautuminen vaaditaan");await H(M(m,g),{countryCca3:s,userId:i.uid,userEmail:i.email||"",text:n,createdAt:J.now()})},Z=async s=>{const n=$(M(m,g),z("countryCca3","==",s),_("createdAt","asc"));return(await G(n)).docs.map(i=>({id:i.id,...i.data()}))},tt=async(s,n)=>{if(!h().currentUser)throw new Error("Kirjautuminen vaaditaan");const c=D(m,g,s);await Q(c,{text:n})},et=async s=>{if(!h().currentUser)throw new Error("Kirjautuminen vaaditaan");const i=D(m,g,s);await X(i)},ot=()=>{var T,S,A;const{cca3:s}=U(),[n,l]=r.useState(null),[i,c]=r.useState(!0),[k,w]=r.useState(null),[v,j]=r.useState({visited:[],wishlist:[]}),[C,I]=r.useState([]),[x,b]=r.useState(""),[O,y]=r.useState(null),[f,d]=r.useState(""),a=h().currentUser;r.useEffect(()=>{(async()=>{c(!0),w(null);try{if(s){const o=await W(s);l(o)}}catch{w("Maan tietoja ei voitu hakea.")}finally{c(!1)}})()},[s]),r.useEffect(()=>{a&&s&&p(a).then(j)},[a,s]);const u=async()=>{if(s){const o=[...await Z(s)].sort((B,N)=>B.createdAt.toMillis()-N.createdAt.toMillis());I(o)}};r.useEffect(()=>{u()},[s]);const E=async e=>{a&&s&&(await q(a,e,s),p(a).then(j))},L=async e=>{a&&s&&(await V(a,e,s),p(a).then(j))},R=async e=>{e.preventDefault(),!(!a||!x.trim()||!s)&&(await Y(s,x.trim()),b(""),await u())},F=async e=>{!a||!f.trim()||(await tt(e,f.trim()),y(null),d(""),await u())},P=async e=>{a&&(await et(e),await u())};return i?t.jsx("p",{children:"Ladataan tietoja..."}):k?t.jsx("p",{style:{color:"red"},children:k}):n?t.jsxs("div",{className:"country-detail-layout",children:[t.jsxs("div",{className:"country-detail-main",children:[t.jsx(K,{to:"/countries",children:"← Takaisin listaan"}),t.jsx("h1",{children:n.name.common}),t.jsx("img",{src:n.flags.svg,alt:`Lippu: ${n.name.common}`,style:{maxWidth:200}}),((T=n.coatOfArms)==null?void 0:T.svg)&&t.jsxs("div",{children:[t.jsx("h3",{children:"Vaakuna"}),t.jsx("img",{src:n.coatOfArms.svg,alt:`Vaakuna: ${n.name.common}`,style:{maxWidth:150}})]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Pääkaupunki:"})," ",((S=n.capital)==null?void 0:S.join(", "))||"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Väkiluku:"})," ",n.population.toLocaleString("fi-FI")]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Pinta-ala:"})," ",n.area.toLocaleString("fi-FI")," km²"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Maanosa:"})," ",n.region," (",n.subregion,")"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Valuutat:"})," ",n.currencies?Object.values(n.currencies).map(e=>e.name+(e.symbol?` (${e.symbol})`:"")).join(", "):"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Kielet:"})," ",n.languages?Object.values(n.languages).join(", "):"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Rajanaapurit:"})," ",(A=n.borders)!=null&&A.length?n.borders.join(", "):"Ei"]}),t.jsx("p",{children:t.jsx("a",{href:n.maps.googleMaps,target:"_blank",rel:"noopener noreferrer",children:"Avaa Google Mapsissa"})}),a&&s&&t.jsx("div",{style:{marginTop:32},children:t.jsxs("div",{style:{display:"flex",gap:16},children:[v.visited.includes(s)?t.jsx("button",{onClick:()=>L("visited"),style:{background:"#e74c3c",color:"white"},children:"Poista merkintä käynnistäni"}):t.jsx("button",{onClick:()=>E("visited"),style:{background:"#27ae60",color:"white"},children:"Olen käynyt täällä!"}),v.wishlist.includes(s)?t.jsx("button",{onClick:()=>L("wishlist"),style:{background:"#e74c3c",color:"white"},children:"Poista matka toivelistaltani!"}):t.jsx("button",{onClick:()=>E("wishlist"),style:{background:"#2980ef",color:"white"},children:"Haluan matkustaa tänne!"})]})})]}),t.jsx("div",{className:"country-detail-side",children:t.jsxs("div",{className:"comment-section",style:{marginTop:40},children:[t.jsx("h3",{children:"Kommentit"}),a&&s&&t.jsxs("form",{onSubmit:R,style:{marginBottom:16},children:[t.jsx("textarea",{value:x,onChange:e=>b(e.target.value),rows:2,style:{width:"100%",maxWidth:400},placeholder:"Jätä julkinen kommentti..."}),t.jsx("button",{type:"submit",style:{marginTop:8},children:"Lähetä"})]}),C.length===0&&t.jsx("p",{children:"Ei kommentteja vielä."}),t.jsx("ul",{style:{listStyle:"none",padding:0},children:C.map(e=>t.jsxs("li",{style:{marginBottom:16,background:"#f3f7fa",borderRadius:8,padding:12},children:[t.jsx("div",{style:{fontWeight:500,color:"#185a9d",marginBottom:4},children:e.userEmail||"Tuntematon käyttäjä"}),O===e.id?t.jsxs(t.Fragment,{children:[t.jsx("textarea",{value:f,onChange:o=>d(o.target.value),rows:2,style:{width:"100%",maxWidth:400}}),t.jsxs("div",{style:{marginTop:4},children:[t.jsx("button",{onClick:()=>F(e.id),style:{marginRight:8},children:"Tallenna"}),t.jsx("button",{onClick:()=>{y(null),d("")},children:"Peruuta"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginBottom:4},children:e.text}),a&&a.uid===e.userId&&t.jsxs("div",{children:[t.jsx("button",{onClick:()=>{y(e.id),d(e.text)},style:{marginRight:8,background:"#2980ef",color:"white"},children:"Muokkaa"}),t.jsx("button",{onClick:()=>P(e.id),style:{background:"#e74c3c",color:"white"},children:"Poista"})]})]}),t.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:e.createdAt.toDate().toLocaleString("fi-FI")})]},e.id))})]})})]}):t.jsx("p",{children:"Maatietoja ei löytynyt."})};export{ot as default};
