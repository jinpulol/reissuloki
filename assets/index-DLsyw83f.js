import{j as e,a as o}from"./react-BWFZKfll.js";import{c as Z}from"./react-dom-B0g7UFVY.js";import"./firebase-Cf3k5pLd.js";import{i as ee,g as te,a as se,b as ne,c as ae,s as ie,d as N,e as re,u as V,f as oe,h as le,j as ce,q as ue,o as de,w as me,k as H,l as he,m as je,T as pe,n as xe,p as fe}from"./@firebase-D3pZ18GH.js";import{a as A}from"./axios-xsH4HHeE.js";import{L as T,u as ge,a as ye,B as ve,R as U,b as w}from"./react-router-DKf4dVeu.js";import"./scheduler-SPyfQU6S.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./cookie--_YQFYBD.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const we={apiKey:"AIzaSyAu5doRHONhFnxVGRQL8V2G7qA1Rtza7vo",authDomain:"kirjahylly-96b27.firebaseapp.com",projectId:"kirjahylly-96b27",storageBucket:"kirjahylly-96b27.firebasestorage.app",messagingSenderId:"278354228484",appId:"1:278354228484:web:174dc5edfbabb843f14c51"},$=ee(we),b=te($),y=se($,{persistence:[ne]}),z="https://restcountries.com/v3.1",I=async()=>{try{return(await A.get(`${z}/all?fields=name,cca3,flags,population,region,capital`)).data}catch(t){throw console.error("Error fetching all countries summary:",t),t}},ke=async t=>{var s;try{return(await A.get(`${z}/alpha/${t}`)).data[0]||null}catch(n){if(console.error(`Error fetching country by cca3 code ${t}:`,n),A.isAxiosError(n)&&((s=n.response)==null?void 0:s.status)===404)return null;throw n}},F=({country:t})=>{var s;return e.jsxs(T,{to:`/country/${t.cca3}`,className:"country-card",children:[e.jsx("img",{src:t.flags.svg,alt:`Lippu: ${t.name.common}`,loading:"lazy"}),e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{children:t.name.common}),e.jsxs("p",{children:["Pääkaupunki: ",((s=t.capital)==null?void 0:s[0])||"Ei tietoa"]}),e.jsxs("p",{children:["Väkiluku: ",t.population.toLocaleString("fi-FI")]}),e.jsxs("p",{children:["Maanosa: ",t.region]})]})]})},W=()=>{const[t,s]=o.useState([]),[n,i]=o.useState([]),[a,r]=o.useState(!0),[c,u]=o.useState(null),[l,p]=o.useState(""),[g,x]=o.useState("");o.useEffect(()=>{(async()=>{try{r(!0);const f=[...await I()].sort((d,k)=>d.name.common.localeCompare(k.name.common));s(f),i(f),u(null)}catch(h){u("Maiden tietoja ei voitu ladata. Yritä myöhemmin uudelleen."),console.error(h)}finally{r(!1)}})()},[]);const v=o.useMemo(()=>{const m=new Set(t.map(h=>h.region).sort());return Array.from(m)},[t]),R=async m=>{if(m.preventDefault(),!l&&!g){i(t);return}r(!0),u(null);try{let h=[];l?h=t.filter(f=>f.name.common.toLowerCase().includes(l.toLowerCase())||f.capital&&f.capital.join(", ").toLowerCase().includes(l.toLowerCase())):h=[...t],g&&(h=h.filter(f=>f.region===g)),h=h.sort((f,d)=>f.name.common.localeCompare(d.name.common)),i(h)}catch(h){u("Haussa tapahtui virhe."),console.error(h),i([])}finally{r(!1)}};return a&&n.length===0?e.jsx("p",{children:"Ladataan maita..."}):c?e.jsx("p",{role:"alert",style:{color:"red"},children:c}):e.jsxs("div",{className:"country-list-container",children:[e.jsx("h1",{children:"Tutustu Maailman Maihin"}),e.jsxs("form",{onSubmit:R,className:"filter-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"search-term",children:"Hae maan tai pääkaupungin nimellä:"}),e.jsx("input",{id:"search-term",type:"text",value:l,onChange:m=>p(m.target.value),placeholder:"Hae englannin kielisillä nimillä, esim. Finland tai London"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"region-select",children:"Suodata maanosan mukaan:"}),e.jsxs("select",{id:"region-select",value:g,onChange:m=>x(m.target.value),children:[e.jsx("option",{value:"",children:"Kaikki maanosat"}),v.map(m=>e.jsx("option",{value:m,children:m},m))]})]}),e.jsx("button",{type:"submit",disabled:a,children:a?"Haetaan...":"Hae / Suodata"})]}),n.length===0&&!a&&e.jsx("p",{children:"Ei hakutuloksia."}),e.jsx("div",{className:"country-grid","aria-live":"polite",children:n.map(m=>e.jsx(F,{country:m},m.cca3))})]})},L=({id:t,label:s,type:n="text",value:i,onChange:a,required:r,minLength:c})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:t,children:s}),e.jsx("input",{id:t,type:n,value:i,onChange:a,required:r,minLength:c})]}),_=t=>e.jsx("button",{...t}),Ce=()=>{const[t,s]=o.useState(""),[n,i]=o.useState(""),[a,r]=o.useState(null),[c,u]=o.useState(!1),l=async p=>{p.preventDefault(),r(null),u(!1);try{await ae(y,t,n),u(!0),s(""),i("")}catch(g){r(g.message||"Rekisteröityminen epäonnistui.")}};return e.jsxs("div",{className:"register-container",children:[e.jsx("h2",{children:"Luo uusi käyttäjä"}),e.jsxs("form",{onSubmit:l,children:[e.jsx(L,{id:"email",label:"Sähköposti:",type:"email",value:t,onChange:p=>s(p.target.value),required:!0}),e.jsx(L,{id:"password",label:"Salasana:",type:"password",value:n,onChange:p=>i(p.target.value),required:!0,minLength:6}),e.jsx(_,{type:"submit",style:{width:"100%",marginBottom:10},children:"Rekisteröidy"}),e.jsx("a",{href:"/",style:{display:"block",color:"#e74c3c",textAlign:"center",marginTop:0,fontSize:"0.98rem",textDecoration:"underline",cursor:"pointer",fontWeight:500},children:"Peruuta"})]}),a&&e.jsx("p",{style:{color:"red"},children:a}),c&&e.jsx("p",{style:{color:"green"},children:"Rekisteröityminen onnistui!"})]})},q=()=>{const[t,s]=o.useState(""),[n,i]=o.useState(""),[a,r]=o.useState(null),c=ge(),u=async l=>{l.preventDefault(),r(null);try{await ie(y,t,n),c("/countries")}catch{r("Kirjautuminen epäonnistui. Tarkista sähköposti ja salasana.")}};return e.jsxs("div",{className:"login-container",children:[e.jsx("h1",{children:"Tervetuloa Reissulokiin!"}),e.jsx("h2",{children:"Kirjaudu sisään"}),e.jsxs("form",{onSubmit:u,children:[e.jsx(L,{id:"login-email",label:"Sähköposti:",type:"email",value:t,onChange:l=>s(l.target.value),required:!0}),e.jsx(L,{id:"login-password",label:"Salasana:",type:"password",value:n,onChange:l=>i(l.target.value),required:!0}),e.jsx(_,{type:"submit",children:"Kirjaudu"})]}),a&&e.jsx("p",{style:{color:"red",marginTop:12},children:a}),e.jsxs("p",{children:["Ei tiliä? ",e.jsx(T,{to:"/register",children:"Rekisteröidy tästä"})]})]})},P=t=>N(b,"users",t.uid),be=async(t,s,n)=>{const i=P(t);await le(i,{[s]:ce(n)},{merge:!0})},Se=async(t,s,n)=>{const i=P(t);await V(i,{[s]:oe(n)})},C=async t=>{const s=P(t),n=await re(s);if(!n.exists())return{visited:[],wishlist:[]};const i=n.data();return{visited:i.visited||[],wishlist:i.wishlist||[]}},E="countryComments",Le=async(t,s)=>{const n=y.currentUser;if(!n)throw new Error("Kirjautuminen vaaditaan");await je(H(b,E),{countryCca3:t,userId:n.uid,userEmail:n.email||"",text:s,createdAt:pe.now()})},Ee=async t=>{const s=ue(H(b,E),me("countryCca3","==",t),de("createdAt","asc"));return(await he(s)).docs.map(i=>({id:i.id,...i.data()}))},Re=async(t,s)=>{if(!y.currentUser)throw new Error("Kirjautuminen vaaditaan");const i=N(b,E,t);await V(i,{text:s})},Ae=async t=>{if(!y.currentUser)throw new Error("Kirjautuminen vaaditaan");const n=N(b,E,t);await xe(n)},Ne=({comments:t,userId:s,editingId:n,editingText:i,setEditingId:a,setEditingText:r,onEdit:c,onDelete:u})=>e.jsx("ul",{style:{listStyle:"none",padding:0},children:t.map(l=>e.jsxs("li",{style:{marginBottom:16,background:"#f3f7fa",borderRadius:8,padding:12},children:[e.jsx("div",{style:{fontWeight:500,color:"#185a9d",marginBottom:4},children:l.userEmail||"Tuntematon käyttäjä"}),n===l.id?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:i,onChange:p=>r(p.target.value),rows:2,style:{width:"100%",maxWidth:400}}),e.jsxs("div",{style:{marginTop:4},children:[e.jsx("button",{onClick:()=>c(l.id),style:{marginRight:8},children:"Tallenna"}),e.jsx("button",{onClick:()=>{a(null),r("")},children:"Peruuta"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:4},children:l.text}),s===l.userId&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{a(l.id),r(l.text)},style:{marginRight:8,background:"#2980ef",color:"white"},children:"Muokkaa"}),e.jsx("button",{onClick:()=>u(l.id),style:{background:"#e74c3c",color:"white"},children:"Poista"})]})]}),e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:l.createdAt.toDate().toLocaleString("fi-FI")})]},l.id))}),Te=({value:t,onChange:s,onSubmit:n,disabled:i})=>e.jsxs("form",{onSubmit:n,style:{marginBottom:16},children:[e.jsx("textarea",{value:t,onChange:s,rows:2,style:{width:"100%",maxWidth:400},placeholder:"Jätä julkinen kommentti...",disabled:i}),e.jsx("button",{type:"submit",style:{marginTop:8},disabled:i,children:"Lähetä"})]}),Ie=()=>{var K,O,B;const{cca3:t}=ye(),[s,n]=o.useState(null),[i,a]=o.useState(!0),[r,c]=o.useState(null),[u,l]=o.useState({visited:[],wishlist:[]}),[p,g]=o.useState([]),[x,v]=o.useState(""),[R,m]=o.useState(null),[h,f]=o.useState(""),d=y.currentUser;o.useEffect(()=>{(async()=>{a(!0),c(null);try{if(t){const S=await ke(t);n(S)}}catch{c("Maan tietoja ei voitu hakea.")}finally{a(!1)}})()},[t]),o.useEffect(()=>{d&&t&&C(d).then(l)},[d,t]);const k=async()=>{if(t){const S=[...await Ee(t)].sort((Y,X)=>Y.createdAt.toMillis()-X.createdAt.toMillis());g(S)}};o.useEffect(()=>{k()},[t]);const D=async j=>{d&&t&&(await be(d,j,t),C(d).then(l))},M=async j=>{d&&t&&(await Se(d,j,t),C(d).then(l))},G=async j=>{j.preventDefault(),!(!d||!x.trim()||!t)&&(await Le(t,x.trim()),v(""),await k())},J=async j=>{!d||!h.trim()||(await Re(j,h.trim()),m(null),f(""),await k())},Q=async j=>{d&&(await Ae(j),await k())};return i?e.jsx("p",{children:"Ladataan tietoja..."}):r?e.jsx("p",{style:{color:"red"},children:r}):s?e.jsxs("div",{className:"country-detail-layout",children:[e.jsxs("div",{className:"country-detail-main",children:[e.jsx(T,{to:"/countries",children:"← Takaisin listaan"}),e.jsx("h1",{children:s.name.common}),e.jsx("img",{src:s.flags.svg,alt:`Lippu: ${s.name.common}`,style:{maxWidth:200}}),((K=s.coatOfArms)==null?void 0:K.svg)&&e.jsxs("div",{children:[e.jsx("h3",{children:"Vaakuna"}),e.jsx("img",{src:s.coatOfArms.svg,alt:`Vaakuna: ${s.name.common}`,style:{maxWidth:150}})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pääkaupunki:"})," ",((O=s.capital)==null?void 0:O.join(", "))||"Ei tietoa"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Väkiluku:"})," ",s.population.toLocaleString("fi-FI")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pinta-ala:"})," ",s.area.toLocaleString("fi-FI")," km²"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Maanosa:"})," ",s.region," (",s.subregion,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valuutat:"})," ",s.currencies?Object.values(s.currencies).map(j=>j.name+(j.symbol?` (${j.symbol})`:"")).join(", "):"Ei tietoa"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kielet:"})," ",s.languages?Object.values(s.languages).join(", "):"Ei tietoa"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Rajanaapurit:"})," ",(B=s.borders)!=null&&B.length?s.borders.join(", "):"Ei"]}),e.jsx("p",{children:e.jsx("a",{href:s.maps.googleMaps,target:"_blank",rel:"noopener noreferrer",children:"Avaa Google Mapsissa"})}),d&&t&&e.jsx("div",{style:{marginTop:32},children:e.jsxs("div",{style:{display:"flex",gap:16},children:[u.visited.includes(t)?e.jsx("button",{onClick:()=>M("visited"),style:{background:"#e74c3c",color:"white"},children:"Poista merkintä käynnistäni"}):e.jsx("button",{onClick:()=>D("visited"),style:{background:"#27ae60",color:"white"},children:"Olen käynyt täällä!"}),u.wishlist.includes(t)?e.jsx("button",{onClick:()=>M("wishlist"),style:{background:"#e74c3c",color:"white"},children:"Poista matka toivelistaltani!"}):e.jsx("button",{onClick:()=>D("wishlist"),style:{background:"#2980ef",color:"white"},children:"Haluan matkustaa tänne!"})]})})]}),e.jsx("div",{className:"country-detail-side",children:e.jsxs("div",{className:"comment-section",style:{marginTop:40},children:[e.jsx("h3",{children:"Kommentit"}),d&&t&&e.jsx(Te,{value:x,onChange:j=>v(j.target.value),onSubmit:G}),p.length===0&&e.jsx("p",{children:"Ei kommentteja vielä."}),e.jsx(Ne,{comments:p,userId:d==null?void 0:d.uid,editingId:R,editingText:h,setEditingId:m,setEditingText:f,onEdit:J,onDelete:Q})]})})]}):e.jsx("p",{children:"Maatietoja ei löytynyt."})},Fe=()=>{const[t,s]=o.useState([]),[n,i]=o.useState(!0),[a,r]=o.useState(null),c=y.currentUser;return o.useEffect(()=>{(async()=>{i(!0),r(null);try{if(c){const l=await C(c),g=(await I()).filter(x=>l.visited.includes(x.cca3));s(g.sort((x,v)=>x.name.common.localeCompare(v.name.common)))}}catch{r("Käytyjen maiden hakeminen epäonnistui.")}finally{i(!1)}})()},[c]),c?n?e.jsx("p",{children:"Ladataan käytyjä maita..."}):a?e.jsx("p",{style:{color:"red"},children:a}):e.jsxs("div",{className:"country-list-container",children:[e.jsx("h1",{children:"Käymäni maat"}),t.length===0?e.jsx("p",{children:"Et ole vielä merkinnyt käytyjä maita."}):e.jsx("div",{className:"country-grid",children:t.map(u=>e.jsx(F,{country:u},u.cca3))})]}):e.jsx("p",{children:"Kirjaudu sisään nähdäksesi käydyt maat."})},Pe=()=>{const[t,s]=o.useState([]),[n,i]=o.useState(!0),[a,r]=o.useState(null),c=y.currentUser;return o.useEffect(()=>{(async()=>{i(!0),r(null);try{if(c){const l=await C(c),g=(await I()).filter(x=>l.wishlist.includes(x.cca3));s(g.sort((x,v)=>x.name.common.localeCompare(v.name.common)))}}catch{r("Toivelistan hakeminen epäonnistui.")}finally{i(!1)}})()},[c]),c?n?e.jsx("p",{children:"Ladataan toivelistan maita..."}):a?e.jsx("p",{style:{color:"red"},children:a}):e.jsxs("div",{className:"country-list-container",children:[e.jsx("h1",{children:"Haluan matkustaa tänne"}),t.length===0?e.jsx("p",{children:"Et ole vielä lisännyt maita toivelistalle."}):e.jsx("div",{className:"country-grid",children:t.map(u=>e.jsx(F,{country:u},u.cca3))})]}):e.jsx("p",{children:"Kirjaudu sisään nähdäksesi toivelistan maat."})};function De(){const[t,s]=o.useState(null),[n,i]=o.useState(!1);return o.useEffect(()=>{const a=fe(y,r=>{s(r),i(!0)});return()=>a()},[]),n?e.jsx(ve,{children:t?e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"main-nav-simple",children:[e.jsxs("div",{className:"nav-left",children:[e.jsx("a",{href:"/countries",children:"Maat"}),e.jsx("a",{href:"/visited",children:"Käydyt maat"}),e.jsx("a",{href:"/wishlist",children:"Toivelista"})]}),e.jsx("div",{className:"nav-spacer",style:{flex:1}}),e.jsx("button",{className:"logout-btn",onClick:()=>y.signOut(),children:"Kirjaudu ulos"})]}),e.jsx("div",{style:{height:68}}),e.jsxs(U,{children:[e.jsx(w,{path:"/countries",element:e.jsx(W,{})}),e.jsx(w,{path:"/country/:cca3",element:e.jsx(Ie,{})}),e.jsx(w,{path:"/visited",element:e.jsx(Fe,{})}),e.jsx(w,{path:"/wishlist",element:e.jsx(Pe,{})}),e.jsx(w,{path:"*",element:e.jsx(W,{})})]})]}):e.jsxs(U,{children:[e.jsx(w,{path:"/login",element:e.jsx(q,{})}),e.jsx(w,{path:"/register",element:e.jsx(Ce,{})}),e.jsx(w,{path:"*",element:e.jsx(q,{})})]})}):e.jsx("div",{style:{minHeight:350,display:"flex",alignItems:"center",justifyContent:"center"},children:"Ladataan..."})}Z.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(De,{})}));
