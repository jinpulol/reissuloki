import{q as U,o as K,w as W,b as M,g as V,a as u,d as q,T as $,e as D,f as h,h as _,i as z,k as G,r as i,j as t,L as H}from"./index-CQblYSe4.js";import{a as J}from"./countryService-BphEq_ek.js";import{g as f,r as Q,a as X}from"./userCountryService-DUWLmqOo.js";const m="countryComments",Y=async(s,n)=>{const r=u.currentUser;if(!r)throw new Error("Kirjautuminen vaaditaan");await q(M(h,m),{countryCca3:s,userId:r.uid,userEmail:r.email||"",text:n,createdAt:$.now()})},Z=async s=>{const n=U(M(h,m),W("countryCca3","==",s),K("createdAt","asc"));return(await V(n)).docs.map(o=>({id:o.id,...o.data()}))},tt=async(s,n)=>{if(!u.currentUser)throw new Error("Kirjautuminen vaaditaan");const o=D(h,m,s);await _(o,{text:n})},et=async s=>{if(!u.currentUser)throw new Error("Kirjautuminen vaaditaan");const r=D(h,m,s);await z(r)},it=()=>{var T,S,A;const{cca3:s}=G(),[n,r]=i.useState(null),[o,p]=i.useState(!0),[k,w]=i.useState(null),[v,j]=i.useState({visited:[],wishlist:[]}),[C,I]=i.useState([]),[x,b]=i.useState(""),[O,g]=i.useState(null),[y,c]=i.useState(""),a=u.currentUser;i.useEffect(()=>{(async()=>{p(!0),w(null);try{if(s){const l=await J(s);r(l)}}catch{w("Maan tietoja ei voitu hakea.")}finally{p(!1)}})()},[s]),i.useEffect(()=>{a&&s&&f(a).then(j)},[a,s]);const d=async()=>{if(s){const l=[...await Z(s)].sort((B,N)=>B.createdAt.toMillis()-N.createdAt.toMillis());I(l)}};i.useEffect(()=>{d()},[s]);const E=async e=>{a&&s&&(await X(a,e,s),f(a).then(j))},L=async e=>{a&&s&&(await Q(a,e,s),f(a).then(j))},R=async e=>{e.preventDefault(),!(!a||!x.trim()||!s)&&(await Y(s,x.trim()),b(""),await d())},F=async e=>{!a||!y.trim()||(await tt(e,y.trim()),g(null),c(""),await d())},P=async e=>{a&&(await et(e),await d())};return o?t.jsx("p",{children:"Ladataan tietoja..."}):k?t.jsx("p",{style:{color:"red"},children:k}):n?t.jsxs("div",{className:"country-detail-layout",children:[t.jsxs("div",{className:"country-detail-main",children:[t.jsx(H,{to:"/countries",children:"← Takaisin listaan"}),t.jsx("h1",{children:n.name.common}),t.jsx("img",{src:n.flags.svg,alt:`Lippu: ${n.name.common}`,style:{maxWidth:200}}),((T=n.coatOfArms)==null?void 0:T.svg)&&t.jsxs("div",{children:[t.jsx("h3",{children:"Vaakuna"}),t.jsx("img",{src:n.coatOfArms.svg,alt:`Vaakuna: ${n.name.common}`,style:{maxWidth:150}})]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Pääkaupunki:"})," ",((S=n.capital)==null?void 0:S.join(", "))||"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Väkiluku:"})," ",n.population.toLocaleString("fi-FI")]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Pinta-ala:"})," ",n.area.toLocaleString("fi-FI")," km²"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Maanosa:"})," ",n.region," (",n.subregion,")"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Valuutat:"})," ",n.currencies?Object.values(n.currencies).map(e=>e.name+(e.symbol?` (${e.symbol})`:"")).join(", "):"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Kielet:"})," ",n.languages?Object.values(n.languages).join(", "):"Ei tietoa"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Rajanaapurit:"})," ",(A=n.borders)!=null&&A.length?n.borders.join(", "):"Ei"]}),t.jsx("p",{children:t.jsx("a",{href:n.maps.googleMaps,target:"_blank",rel:"noopener noreferrer",children:"Avaa Google Mapsissa"})}),a&&s&&t.jsx("div",{style:{marginTop:32},children:t.jsxs("div",{style:{display:"flex",gap:16},children:[v.visited.includes(s)?t.jsx("button",{onClick:()=>L("visited"),style:{background:"#e74c3c",color:"white"},children:"Poista merkintä käynnistäni"}):t.jsx("button",{onClick:()=>E("visited"),style:{background:"#27ae60",color:"white"},children:"Olen käynyt täällä!"}),v.wishlist.includes(s)?t.jsx("button",{onClick:()=>L("wishlist"),style:{background:"#e74c3c",color:"white"},children:"Poista matka toivelistaltani!"}):t.jsx("button",{onClick:()=>E("wishlist"),style:{background:"#2980ef",color:"white"},children:"Haluan matkustaa tänne!"})]})})]}),t.jsx("div",{className:"country-detail-side",children:t.jsxs("div",{className:"comment-section",style:{marginTop:40},children:[t.jsx("h3",{children:"Kommentit"}),a&&s&&t.jsxs("form",{onSubmit:R,style:{marginBottom:16},children:[t.jsx("textarea",{value:x,onChange:e=>b(e.target.value),rows:2,style:{width:"100%",maxWidth:400},placeholder:"Jätä julkinen kommentti..."}),t.jsx("button",{type:"submit",style:{marginTop:8},children:"Lähetä"})]}),C.length===0&&t.jsx("p",{children:"Ei kommentteja vielä."}),t.jsx("ul",{style:{listStyle:"none",padding:0},children:C.map(e=>t.jsxs("li",{style:{marginBottom:16,background:"#f3f7fa",borderRadius:8,padding:12},children:[t.jsx("div",{style:{fontWeight:500,color:"#185a9d",marginBottom:4},children:e.userEmail||"Tuntematon käyttäjä"}),O===e.id?t.jsxs(t.Fragment,{children:[t.jsx("textarea",{value:y,onChange:l=>c(l.target.value),rows:2,style:{width:"100%",maxWidth:400}}),t.jsxs("div",{style:{marginTop:4},children:[t.jsx("button",{onClick:()=>F(e.id),style:{marginRight:8},children:"Tallenna"}),t.jsx("button",{onClick:()=>{g(null),c("")},children:"Peruuta"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginBottom:4},children:e.text}),a&&a.uid===e.userId&&t.jsxs("div",{children:[t.jsx("button",{onClick:()=>{g(e.id),c(e.text)},style:{marginRight:8,background:"#2980ef",color:"white"},children:"Muokkaa"}),t.jsx("button",{onClick:()=>P(e.id),style:{background:"#e74c3c",color:"white"},children:"Poista"})]})]}),t.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:e.createdAt.toDate().toLocaleString("fi-FI")})]},e.id))})]})})]}):t.jsx("p",{children:"Maatietoja ei löytynyt."})};export{it as default};
